题目来源：[【PR #11】作业](https://pjudge.ac/contest/1289/problem/21778)  

### 算法一 $ n = 2 $ 且 $ a_i \leq 5 $

先暴力求出每个长度时每个最小表示位置的概率，询问时枚举位置算答案。  

期望得分 $ 5 $ 分。  

### 算法二 $ a_i \leq 5 $

根据期望的线性性/可加性，执行 $ n $ 次询问求和。  

注意 $ n = 1 $ 的情况要特判。  

期望得分 $ 10 $ 分。  

### 算法三 $ a_i $ 全为质数

问题可以一般化成求两个字符串的 $ f $ 值相等的概率。  

一个字符串 $ s $ 的 $ f $ 值和它的循环节长度有关，设循环节长度为 $ d $，则 $ f(s) \in [1, d] $，且 $ f(s) = i \in [1, d] $ 的概率都是相等的，因为每组循环同构的字符串在每个位置都有 $ 1 $ 的贡献。  

$ a_i $ 为质数，那么循环节长度只可能是 $ 1 $ 和 $ a_i $，概率分别为 $ \dfrac {26} {26^{a_i}} $ 和 $ 1 - \dfrac {26} {26^{a_i}} $。  

考虑两个长度分别为 $ x $ 和 $ y $ 的字符串如何计算概率。  

$ f(s_x) = 1 $ 的概率是 $ \dfrac {26} {26^x} + (1 - \dfrac {26} {26^x}) \times \dfrac 1 x $，$ f(s_x) = [2, x] $ 的概率分别是 $ (1 - \dfrac {26} {26^x}) \times \dfrac 1 x $；$ f(s_y) $ 同理。  

对 $ f(s_x) = f(s_y) = 1 $ 和 $ f(s_x) = f(s_y) > 1 $ 两种情况分类讨论即可。  

注意 $ n = 1 $ 的情况要特判。  

期望得分 $ 20 $ 分。  

### 算法四 $ \sum a_i \leq 10^5 $

在算法三的基础上，枚举位置 $ f $ 和两个字符串的循环节长度 $ d_x $ 和 $ d_y $，则概率为 $ \Big ( \sum\limits_{d_x \mid x, d_x \geq f} \dfrac {cnt(d_x)} {26^x} \times \dfrac 1 {d_x} \Big ) \times \Big ( \sum\limits_{d_y \mid y, d_y \geq f} \dfrac {cnt(d_y)} {26^y} \times \dfrac 1 {d_y} \Big ) $，$ d_x / d_y \geq f $ 的限制可以用后缀和。  

其中 $ cnt(d) $ 表示长度为 $ d $ 且循环节长度也为 $ d $ 的字符串个数；容斥可得，$ cnt(d) = \sum\limits_{c \mid d} \mu(c) \times 26^{d / c} $。  

枚举 $ f $ 的复杂度是 $ \mathcal O (\sum a_i) $ 的。  

注意 $ n = 1 $ 的情况要特判。  

期望得分 $ 25 $ 分。  

### 算法五

在算法四的基础上，求解时只需要枚举 $ d_x $ 和 $ d_y $，此时符合条件的 $ f $ 的个数是 $ \min (d_x, d_y) $。  

$ \mathcal O (n \log V) $ 预处理出 $ cnt(d) $ 后，每次询问就能用 双指针+后缀和 做到 $ \mathcal O (D) $ 回答，其中 $ V $ 是值域，$ D $ 是因数个数，显然有 $ D \leq 2 \sqrt V$。  

最终的时间复杂度为 $ \mathcal O (n \log V + n \sqrt V) $。  

注意 $ n = 1 $ 的情况要特判。  

期望得分 $ 100 $ 分。  
